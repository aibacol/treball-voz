<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Espectrograma</title>
</head>
<body>
    <h1>Espectrograma</h1>
    <button onclick="verEspectrograma()">Ver Espectrograma</button>
    <button onclick="verEspectrogramaLog()">Ver Espectrograma Log</button>
    <button onclick="verEspectrogramaMel()">Ver Espectrograma Mel</button>
    <button onclick="seleccionarArchivo()">Seleccionar Archivo</button>
    <button onclick="iniciarGrabacion()">Iniciar Grabación</button>
    <button onclick="detenerGrabacion()">Detener Grabación</button>
    <button onclick="descargarGrabacion()">Descargar Grabación</button>
    <input type="file" id="seleccionarArchivoInput" accept="audio/*" style="display: none;">
    <div id="espectrograma"></div>

    <script>
        var mediaRecorder; // Variable global para almacenar el objeto MediaRecorder
        var audioChunks = []; // Array para almacenar los fragmentos de audio grabados

        function iniciarGrabacion() {
            // Solicitar acceso al micrófono del usuario
            navigator.mediaDevices.getUserMedia({ audio: true })
                .then(function(stream) {
                    // Crear un objeto MediaRecorder para grabar audio
                    mediaRecorder = new MediaRecorder(stream);

                    // Evento que se activa cuando se graba un nuevo fragmento de audio
                    mediaRecorder.addEventListener('dataavailable', function(event) {
                        audioChunks.push(event.data);
                    });

                    // Comenzar a grabar audio
                    mediaRecorder.start();
                })
                .catch(function(error) {
                    console.error('Error al acceder al micrófono:', error);
                });
        }

        function detenerGrabacion() {
            if (mediaRecorder && mediaRecorder.state === 'recording') {
                mediaRecorder.stop(); // Detener la grabación si está en curso
            }
        }

        function descargarGrabacion() {
            // Comprobar si hay fragmentos de audio grabados
            if (audioChunks.length === 0) {
                console.warn('No hay audio grabado.');
                return;
            }

            // Convertir los fragmentos de audio a un blob
            var audioBlob = new Blob(audioChunks, { type: 'audio/wav' });

            // Crear un objeto URL para el blob
            var audioURL = URL.createObjectURL(audioBlob);

            // Crear un enlace invisible para descargar el archivo WAV
            var descargarEnlace = document.createElement('a');
            descargarEnlace.href = audioURL;
            descargarEnlace.download = 'grabacion.wav';
            document.body.appendChild(descargarEnlace);

            // Hacer clic en el enlace para iniciar la descarga del archivo WAV
            descargarEnlace.click();

            // Limpiar el array de fragmentos de audio
            audioChunks = [];
        }

        // Resto de las funciones para ver el espectrograma y seleccionar archivo...
    </script>
</body>
</html>
